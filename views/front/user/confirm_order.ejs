<div class="container" ng-controller="confirmOrder">
    <legend><%=title%></legend>
    <div class="tab-confirm-order">
        <ul class="nav nav-tabs" role=tablist>
            <li role="presentation" class="active"><a href="#confirmOrder" aria-control="confirmOrder" role="tab" data-toggle="tab">Confirm</a></li>
            <li role="presentation" class=""><a href="#payOrder" aria-control="payOrder" role="tab" data-toggle="tab">Pay</a></li>
            <li role="presentation" class=""><a href="#doneOrder" aria-control="doneOrder" role="tab" data-toggle="tab">Done</a></li>
        </ul>
        <div class="progress">
            <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100" style="width: 33%;">
                Confirm
            </div>
        </div>
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="confirmOrder">
                <div class="box addressSel">

                </div>
                <div class="box productList">
                    <div class="box">
                        <div class="box-body table-responsive no-padding">
                            <table class="table table-hover">
                                <tr>
                                    <th>Commodity</th>
                                    <th>Unit-price</th>
                                    <th>Quantity</th>
                                    <th>Total</th>
                                    <th>Operation</th>
                                </tr>
                                <tr class="datalist" ng-repeat="item in orderData.products">
                                    <td>
                                        <img src="{{item.logo}}" class="pull-left" style="width:50px;height:50px;margin-right: 10px;" />
                                        <a href="/product/{{item._id}}" title="{{item.name}}">{{item.name | limitTo:70}}</a>
                                    </td>
                                    <td>{{item.price | currency: '$'}}</td>
                                    <td>{{item.quantity}}</td>
                                    <td class="text-danger">{{item.price * item.quantity | currency: '$'}}</td>
                                    <td>
                                        <button class="btn btn-danger btn-xs" ng-click="deleteItems(item._id)"><span class="fa fa-fw fa-remove" aria-hidden="true"></span>Delete</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td class="text-right h4">Selected Items: </td>
                                    <td class="text-danger h4">{{orderData.products.length}}</td>
                                    <td class="text-right h4">Total:</td>
                                    <td class="text-danger h4"><b>{{orderData.total | currency: '$'}}</b></td>
                                    <td></td>
                                </tr>
                            </table>
                        </div>
                    </div><!-- End div.box -->
                </div>
                <div class="box summary">

                </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="payOrder">

            </div>
            <div role="tabpanel" class="tab-pane" id="doneOrder">

            </div>
        </div>
    </div>
</div>

<script>

    App.controller('confirmOrder', function ($scope, $http) {
        var user_id = '<%=userInfo._id%>';

        $scope.load = function () {
            $scope.productData = [];
            $scope.addressData = [];

            $http.get('/api/v1/user/' + user_id).success(function (data) {
                if (typeof data === 'object') {
                    $scope.addressData = data.address;
                } else {
                    console.log('error');
                    showErrorInfo('get user info failed.');
                }
            });

            $http.get('/api/v1/order/cart').success(function (data) {
                if (typeof data === 'object') {
                    $scope.orderData = data;
                    for (var i = 0; i < data.products.length; i++) {
                        (function (i) {
                            $http.get('/api/v1/product/' + data.products[i]._id + '?part=1').success(function (result) {
                                if (typeof result === 'object') {
                                    $.extend($scope.orderData.products[i], result);
                                } else {
                                    console.log('get product' + data.products[i]._id + 'error');
                                }
                            });
                        })(i);
                    }
                } else {
                    console.log('error');
                    showErrorInfo('get order info failed.');
                }
            });
        };

        $scope.load();

    });

</script>
